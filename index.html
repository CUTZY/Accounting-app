<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <title>Fung's Accounting</title>

  </head>
  <body>
    <!-- Login Container -->
    <div id="loginContainer" style="display: block;">
      <div class="login-wrapper">
        <div class="container-fluid">
          <div class="row justify-content-center min-vh-100 align-items-center">
            <div class="col-12 col-md-8 col-lg-6 col-xl-4">
              <div class="login-card">
                <div class="text-center mb-4">
                  <h1 class="login-title">
                    <i class="fas fa-calculator"></i>
                    Fung's Acct
                  </h1>
                  <p class="login-subtitle">Comprehensive Accounting Application</p>
                </div>

                <div class="auth-messages"></div>

                <!-- Login Form -->
                <div id="loginForm">
                  <div class="card">
                    <div class="card-header text-center">
                      <h4><i class="fas fa-sign-in-alt"></i> Sign In</h4>
                    </div>
                    <div class="card-body">
                      <form onsubmit="event.preventDefault(); performLogin();">
                        <div class="form-group">
                          <label for="loginUsername">
                            <i class="fas fa-user"></i> Username or Email
                          </label>
                          <input 
                            type="text" 
                            class="form-control" 
                            id="loginUsername" 
                            placeholder="Enter your username or email"
                            required
                            autocomplete="username"
                          >
                        </div>
                        <div class="form-group">
                          <label for="loginPassword">
                            <i class="fas fa-lock"></i> Password
                          </label>
                          <input 
                            type="password" 
                            class="form-control" 
                            id="loginPassword" 
                            placeholder="Enter your password"
                            required
                            autocomplete="current-password"
                          >
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">
                          <i class="fas fa-sign-in-alt"></i> Sign In
                        </button>
                      </form>
                    </div>
                    <div class="card-footer text-center">
                      <div class="mb-2">
                        <small>Don't have an account?</small>
                        <a href="#" onclick="showRegisterForm()" class="text-primary">
                          <strong>Create Account</strong>
                        </a>
                      </div>
                      <div class="mb-2">
                        <small>
                          <a href="#" onclick="showForgotPasswordForm()" class="text-muted">
                            Forgot Password?
                          </a>
                        </small>
                      </div>
                      <hr>
                                              <button onclick="createDemoUser()" class="btn btn-outline-secondary btn-sm">
                          <i class="fas fa-eye"></i> Try Demo Account
                        </button>
                    </div>
                  </div>
                </div>

                <!-- Register Form -->
                <div id="registerForm" style="display: none;">
                  <div class="card">
                    <div class="card-header text-center">
                      <h4><i class="fas fa-user-plus"></i> Create Account</h4>
                    </div>
                    <div class="card-body">
                      <form onsubmit="event.preventDefault(); performRegister();">
                        <div class="row">
                          <div class="col-12 col-md-6">
                            <div class="form-group">
                              <label for="registerFullName">
                                <i class="fas fa-user"></i> Full Name
                              </label>
                              <input 
                                type="text" 
                                class="form-control" 
                                id="registerFullName" 
                                placeholder="Your full name"
                                required
                              >
                            </div>
                          </div>
                          <div class="col-12 col-md-6">
                            <div class="form-group">
                              <label for="registerBusinessName">
                                <i class="fas fa-building"></i> Business Name
                              </label>
                              <input 
                                type="text" 
                                class="form-control" 
                                id="registerBusinessName" 
                                placeholder="Your business name (optional)"
                              >
                            </div>
                          </div>
                        </div>
                        <div class="form-group">
                          <label for="registerUsername">
                            <i class="fas fa-at"></i> Username
                          </label>
                          <input 
                            type="text" 
                            class="form-control" 
                            id="registerUsername" 
                            placeholder="Choose a username"
                            required
                            autocomplete="username"
                          >
                        </div>
                        <div class="form-group">
                          <label for="registerEmail">
                            <i class="fas fa-envelope"></i> Email Address
                          </label>
                          <input 
                            type="email" 
                            class="form-control" 
                            id="registerEmail" 
                            placeholder="your@email.com"
                            required
                            autocomplete="email"
                          >
                        </div>
                        <div class="row">
                          <div class="col-12 col-md-6">
                            <div class="form-group">
                              <label for="registerPassword">
                                <i class="fas fa-lock"></i> Password
                              </label>
                              <input 
                                type="password" 
                                class="form-control" 
                                id="registerPassword" 
                                placeholder="Create a password"
                                required
                                autocomplete="new-password"
                              >
                              <small class="form-text text-muted">
                                Must contain uppercase, lowercase, and number
                              </small>
                            </div>
                          </div>
                          <div class="col-12 col-md-6">
                            <div class="form-group">
                              <label for="registerConfirmPassword">
                                <i class="fas fa-check"></i> Confirm Password
                              </label>
                              <input 
                                type="password" 
                                class="form-control" 
                                id="registerConfirmPassword" 
                                placeholder="Confirm your password"
                                required
                                autocomplete="new-password"
                              >
                            </div>
                          </div>
                        </div>
                        <button type="submit" class="btn btn-success btn-block">
                          <i class="fas fa-user-plus"></i> Create Account
                        </button>
                      </form>
                    </div>
                    <div class="card-footer text-center">
                      <small>Already have an account?</small>
                      <a href="#" onclick="showLoginForm()" class="text-primary">
                        <strong>Sign In</strong>
                      </a>
                    </div>
                  </div>
                </div>

                <!-- Forgot Password Form -->
                <div id="forgotPasswordForm" style="display: none;">
                  <div class="card">
                    <div class="card-header text-center">
                      <h4><i class="fas fa-key"></i> Reset Password</h4>
                    </div>
                    <div class="card-body">
                      <p class="text-muted text-center">
                        Enter your email address and we'll help you reset your password.
                      </p>
                      <form onsubmit="event.preventDefault(); alert('Password reset feature coming soon!');">
                        <div class="form-group">
                          <label for="forgotEmail">
                            <i class="fas fa-envelope"></i> Email Address
                          </label>
                          <input 
                            type="email" 
                            class="form-control" 
                            id="forgotEmail" 
                            placeholder="your@email.com"
                            required
                          >
                        </div>
                        <button type="submit" class="btn btn-warning btn-block">
                          <i class="fas fa-paper-plane"></i> Send Reset Link
                        </button>
                      </form>
                    </div>
                    <div class="card-footer text-center">
                      <small>Remember your password?</small>
                      <a href="#" onclick="showLoginForm()" class="text-primary">
                        <strong>Sign In</strong>
                      </a>
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" style="display: none;">
    <!-- Mobile Header -->
    <div class="mobile-header d-md-none">
      <div class="d-flex justify-content-between align-items-center">
        <button class="mobile-nav-toggle" onclick="toggleMobileNav()" aria-label="Toggle navigation">
          <i class="fas fa-bars"></i>
        </button>
        <h5 class="mb-0">
          <i class="fas fa-calculator"></i> <span class="business-name">Fung's Accounting</span>
        </h5>
        <div style="width: 40px;"></div> <!-- Spacer for centering -->
      </div>
    </div>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" onclick="closeMobileNav()"></div>

    <!-- Sidebar -->
    <nav class="sidebar">
      <button class="sidebar-close d-md-none" onclick="closeMobileNav()" aria-label="Close navigation">
        <i class="fas fa-times"></i>
      </button>
      
      <div class="text-center mb-4 d-none d-md-block">
        <h4 class="text-white">
          <i class="fas fa-calculator"></i> <span class="business-name">Fung's Accounting</span>
        </h4>
      </div>

      <!-- User Info Section -->
      <div class="sidebar-user-info">
        <div class="text-center">
          <div class="user-avatar">
            <i class="fas fa-user"></i>
          </div>
          <div class="user-details">
            <div class="user-name">Loading...</div>
            <div class="business-name">Business Name</div>
            <div class="user-email">email@example.com</div>
          </div>
        </div>
        <div class="text-center mt-2">
          <button class="btn btn-sm btn-outline-light" onclick="showUserProfile()" title="Edit Profile">
            <i class="fas fa-edit"></i>
          </button>
          <button class="btn btn-sm btn-outline-danger ml-1" onclick="performLogout()" title="Logout">
            <i class="fas fa-sign-out-alt"></i>
          </button>
        </div>
      </div>

      <div class="sidebar-divider"></div>
      
      <ul class="nav flex-column">
        <li class="nav-item">
          <a class="nav-link active" href="#" onclick="showTab('dashboard'); closeMobileNav();">
            <i class="fas fa-tachometer-alt"></i> Dashboard
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" onclick="showTab('chart-accounts'); closeMobileNav();">
            <i class="fas fa-list"></i> Chart of Accounts
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" onclick="showTab('journal-entries'); closeMobileNav();">
            <i class="fas fa-book"></i> Journal Entries
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" onclick="showTab('trial-balance'); closeMobileNav();">
            <i class="fas fa-balance-scale"></i> Trial Balance
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" onclick="showTab('balance-sheet'); closeMobileNav();">
            <i class="fas fa-chart-bar"></i> Balance Sheet
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" onclick="showTab('income-statement'); closeMobileNav();">
            <i class="fas fa-chart-line"></i> Income Statement
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" onclick="showTab('about'); closeMobileNav();">
            <i class="fas fa-info-circle"></i> About
          </a>
        </li>
      </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Dashboard Tab -->
      <div id="dashboard" class="tab-content">
        <div class="page-header">
          <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
            <h2><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
            <div class="mt-3 mt-md-0 w-100 w-md-auto">
              <button class="btn btn-primary quick-action-btn" onclick="showTab('journal-entries')">
                <i class="fas fa-plus"></i> New Entry
              </button>
              <button class="btn btn-success quick-action-btn" onclick="showTab('chart-accounts')">
                <i class="fas fa-cog"></i> Manage Accounts
              </button>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-12 col-sm-6 col-lg-3">
            <div class="card summary-card">
              <div class="card-body">
                <h5><i class="fas fa-coins"></i> Total Assets</h5>
                <h3 id="total-assets">$0.00</h3>
              </div>
            </div>
          </div>
          <div class="col-12 col-sm-6 col-lg-3">
            <div class="card summary-card">
              <div class="card-body">
                <h5><i class="fas fa-credit-card"></i> Total Liabilities</h5>
                <h3 id="total-liabilities">$0.00</h3>
              </div>
            </div>
          </div>
          <div class="col-12 col-sm-6 col-lg-3">
            <div class="card summary-card">
              <div class="card-body">
                <h5><i class="fas fa-piggy-bank"></i> Total Equity</h5>
                <h3 id="total-equity">$0.00</h3>
              </div>
            </div>
          </div>
          <div class="col-12 col-sm-6 col-lg-3">
            <div class="card summary-card">
              <div class="card-body">
                <h5><i class="fas fa-chart-line"></i> Net Income</h5>
                <h3 id="net-income">$0.00</h3>
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-12 col-lg-6">
            <div class="card">
              <div class="card-header">
                <i class="fas fa-clock"></i> Recent Journal Entries
              </div>
              <div class="card-body">
                <div id="recent-entries">
                  <p class="text-muted text-center">No recent entries found</p>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-6">
            <div class="card">
              <div class="card-header">
                <i class="fas fa-exclamation-triangle"></i> Account Alerts
              </div>
              <div class="card-body">
                <div id="account-alerts">
                  <p class="text-success"><i class="fas fa-check"></i> All accounts balanced</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Chart of Accounts Tab -->
      <div id="chart-accounts" class="tab-content" style="display: none;">
        <div class="page-header">
          <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
            <h2><i class="fas fa-list"></i> Chart of Accounts</h2>
            <button class="btn btn-primary mt-3 mt-md-0" onclick="showAddAccountModal()">
              <i class="fas fa-plus"></i> Add Account
            </button>
          </div>
        </div>

        <div class="card">
          <div class="card-body">
            <div id="accounts-list">
              <!-- Accounts will be loaded here -->
            </div>
          </div>
        </div>
      </div>

      <!-- Journal Entries Tab -->
      <div id="journal-entries" class="tab-content" style="display: none;">
        <div class="page-header">
          <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
            <h2><i class="fas fa-book"></i> Journal Entries</h2>
            <button class="btn btn-primary mt-3 mt-md-0" onclick="showAddEntryModal()">
              <i class="fas fa-plus"></i> New Entry
            </button>
          </div>
        </div>

        <div class="card">
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead class="thead-dark">
                  <tr>
                    <th>Date</th>
                    <th>Reference</th>
                    <th>Description</th>
                    <th>Account</th>
                    <th>Debit</th>
                    <th>Credit</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="journal-entries-table">
                  <!-- Entries will be loaded here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Trial Balance Tab -->
      <div id="trial-balance" class="tab-content" style="display: none;">
        <div class="page-header">
          <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
            <h2><i class="fas fa-balance-scale"></i> Trial Balance</h2>
            <button class="btn btn-secondary mt-3 mt-md-0" onclick="generateTrialBalance()">
              <i class="fas fa-refresh"></i> Refresh
            </button>
          </div>
        </div>

        <div class="card">
          <div class="card-body">
            <div class="table-responsive">
              <table class="table">
                <thead class="thead-dark">
                  <tr>
                    <th>Account</th>
                    <th>Type</th>
                    <th>Debit</th>
                    <th>Credit</th>
                  </tr>
                </thead>
                <tbody id="trial-balance-table">
                  <!-- Trial balance will be loaded here -->
                </tbody>
                <tfoot>
                  <tr class="table-info font-weight-bold">
                    <td colspan="2">TOTALS</td>
                    <td id="total-debits">$0.00</td>
                    <td id="total-credits">$0.00</td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Balance Sheet Tab -->
      <div id="balance-sheet" class="tab-content" style="display: none;">
        <div class="page-header">
          <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
            <h2><i class="fas fa-chart-bar"></i> Balance Sheet</h2>
            <button class="btn btn-secondary mt-3 mt-md-0" onclick="generateBalanceSheet()">
              <i class="fas fa-refresh"></i> Refresh
            </button>
          </div>
        </div>

        <div class="card">
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead class="thead-dark">
                  <tr>
                    <th>Account</th>
                    <th>Type</th>
                    <th class="text-right">Total Debits</th>
                    <th class="text-right">Total Credits</th>
                    <th class="text-right">Net Balance</th>
                  </tr>
                </thead>
                <tbody id="balance-sheet-table">
                  <!-- Balance sheet will be loaded here -->
                </tbody>
                <tfoot id="balance-sheet-totals">
                  <!-- Totals will be loaded here -->
                </tfoot>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Income Statement Tab -->
      <div id="income-statement" class="tab-content" style="display: none;">
        <div class="page-header">
          <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
            <h2><i class="fas fa-chart-line"></i> Income Statement</h2>
            <button class="btn btn-secondary mt-3 mt-md-0" onclick="generateIncomeStatement()">
              <i class="fas fa-refresh"></i> Refresh
            </button>
          </div>
        </div>

        <div class="card">
          <div class="card-body" id="income-statement-content">
            <!-- Income statement will be loaded here -->
          </div>
        </div>
      </div>

      <!-- About Tab -->
      <div id="about" class="tab-content" style="display: none;">
        <div class="page-header">
          <h2><i class="fas fa-info-circle"></i> About</h2>
        </div>

        <div class="row justify-content-center">
          <div class="col-12 col-lg-8">
            <div class="card">
              <div class="card-header text-center">
                <h4><i class="fas fa-user"></i> Application Information</h4>
              </div>
              <div class="card-body">
                <div class="text-center mb-4">
                  <div class="about-avatar mb-3">
                    <i class="fas fa-user-circle fa-5x text-primary"></i>
                  </div>
                  <h3 class="text-primary">Fung's Acct</h3>
                  <p class="text-muted lead">Comprehensive Accounting Application</p>
                </div>

                <div class="row">
                  <div class="col-12 col-md-6">
                    <div class="card border-left-primary">
                      <div class="card-body">
                        <h5 class="card-title">
                          <i class="fas fa-code text-primary"></i> Developer
                        </h5>
                        <p class="card-text">
                          <strong>Fung Roje Daimary</strong><br>
                          Application Developer & Designer
                        </p>
                      </div>
                    </div>
                  </div>

                  <div class="col-12 col-md-6">
                    <div class="card border-left-success">
                      <div class="card-body">
                        <h5 class="card-title">
                          <i class="fas fa-envelope text-success"></i> Contact Information
                        </h5>
                        <p class="card-text">
                          <strong>Email:</strong><br>
                          <a href="mailto:frddaimary@gmail.com" class="text-success">
                            frddaimary@gmail.com
                          </a>
                        </p>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row mt-3">
                  <div class="col-12 col-md-6">
                    <div class="card border-left-info">
                      <div class="card-body">
                        <h5 class="card-title">
                          <i class="fas fa-phone text-info"></i> Mobile
                        </h5>
                        <p class="card-text">
                          <strong>Phone:</strong><br>
                          <a href="tel:+918761033435" class="text-info">
                            +91 8761033435
                          </a>
                        </p>
                      </div>
                    </div>
                  </div>

                  <div class="col-12 col-md-6">
                    <div class="card border-left-warning">
                      <div class="card-body">
                        <h5 class="card-title">
                          <i class="fas fa-calendar text-warning"></i> Version
                        </h5>
                        <p class="card-text">
                          <strong>Version:</strong> 1.0.0<br>
                          <strong>Built:</strong> 2024
                        </p>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="mt-4">
                  <div class="card border-left-dark">
                    <div class="card-body">
                      <h5 class="card-title">
                        <i class="fas fa-laptop-code text-dark"></i> About This Application
                      </h5>
                      <p class="card-text">
                        Fung's Acct is a comprehensive web-based general ledger accounting application built with modern web technologies. 
                        This application implements double-entry bookkeeping principles and provides all essential accounting features 
                        for small to medium businesses including:
                      </p>
                      <ul class="list-unstyled">
                        <li><i class="fas fa-check text-success"></i> Dashboard with financial summaries</li>
                        <li><i class="fas fa-check text-success"></i> Chart of accounts management</li>
                        <li><i class="fas fa-check text-success"></i> Journal entries with double-entry validation</li>
                        <li><i class="fas fa-check text-success"></i> Financial reports (Trial Balance, Balance Sheet, Income Statement)</li>
                        <li><i class="fas fa-check text-success"></i> Responsive design for all devices</li>
                      </ul>
                    </div>
                  </div>
                </div>

                <div class="text-center mt-4">
                  <div class="mb-3 data-management-buttons">
                    <button class="btn btn-primary btn-lg" onclick="app.loadDemoData()" title="Load sample restaurant data">
                      <i class="fas fa-database"></i> Load Demo Data
                    </button>
                    <button class="btn btn-outline-danger btn-lg" onclick="app.clearAllData()" title="Clear all data and start fresh">
                      <i class="fas fa-trash-alt"></i> Clear All Data
                    </button>
                  </div>
                  <div class="alert alert-info mt-3">
                    <h6><i class="fas fa-rocket"></i> Getting Started</h6>
                    <p class="mb-2"><strong>New to the app?</strong> Click "Load Demo Data" to explore with realistic restaurant transactions and accounts.</p>
                    <p class="mb-0"><strong>Ready for your business?</strong> Click "Clear All Data" to start completely fresh.</p>
                  </div>
                  <p class="text-muted">
                    <i class="fas fa-heart text-danger"></i> 
                    Built with dedication to provide efficient accounting solutions
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Add Account Modal -->
    <div class="modal fade" id="addAccountModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Add New Account</h5>
            <button type="button" class="close" data-dismiss="modal">
              <span>&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="addAccountForm">
              <div class="form-group">
                <label>Account Number</label>
                <input type="text" class="form-control" id="accountNumber" required>
              </div>
              <div class="form-group">
                <label>Account Name</label>
                <input type="text" class="form-control" id="accountName" required>
              </div>
              <div class="form-group">
                <label>Account Type</label>
                <select class="form-control" id="accountType" required>
                  <option value="">Select Type</option>
                  <option value="Asset">Asset</option>
                  <option value="Liability">Liability</option>
                  <option value="Equity">Equity</option>
                  <option value="Revenue">Revenue</option>
                  <option value="Expense">Expense</option>
                </select>
              </div>
              <div class="form-group">
                <label>Description</label>
                <textarea class="form-control" id="accountDescription" rows="3"></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="app.addAccount()">Add Account</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Journal Entry Modal -->
    <div class="modal fade" id="addEntryModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">New Journal Entry</h5>
            <button type="button" class="close" data-dismiss="modal">
              <span>&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="addEntryForm">
              <div class="row">
                <div class="col-12 col-md-6">
                  <div class="form-group">
                    <label>Date</label>
                    <input type="date" class="form-control" id="entryDate" required>
                  </div>
                </div>
                <div class="col-12 col-md-6">
                  <div class="form-group">
                    <label>Reference</label>
                    <input type="text" class="form-control" id="entryReference" placeholder="Optional reference">
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label>Description</label>
                <textarea class="form-control" id="entryDescription" rows="2" required></textarea>
              </div>
              
              <h6>Transaction Lines</h6>
              <div id="transaction-lines">
                <div class="transaction-line">
                  <div class="row">
                    <div class="col-12 col-md-6">
                      <div class="form-group">
                        <label>Account</label>
                        <select class="form-control account-select" required>
                          <option value="">Select Account</option>
                        </select>
                      </div>
                    </div>
                    <div class="col-6 col-md-3">
                      <div class="form-group">
                        <label>Debit</label>
                        <input type="number" step="0.01" class="form-control debit-amount" onchange="updateTotals()">
                      </div>
                    </div>
                    <div class="col-6 col-md-3">
                      <div class="form-group">
                        <label>Credit</label>
                        <input type="number" step="0.01" class="form-control credit-amount" onchange="updateTotals()">
                      </div>
                    </div>
                    <div class="col-12 text-right">
                      <button type="button" class="btn btn-sm btn-danger" onclick="removeTransactionLine(this)">
                        <i class="fas fa-trash"></i> Remove
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3">
                <button type="button" class="btn btn-secondary mb-3 mb-md-0" onclick="addTransactionLine()">
                  <i class="fas fa-plus"></i> Add Line
                </button>
                <div class="text-left text-md-right">
                  <div><strong>Total Debits: $<span id="total-debits-entry">0.00</span></strong></div>
                  <div><strong>Total Credits: $<span id="total-credits-entry">0.00</span></strong></div>
                  <div><span id="balance-status" class="text-danger">Out of Balance</span></div>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" id="save-entry-btn" onclick="app.addJournalEntry()">Save Entry</button>
          </div>
        </div>
      </div>
    </div>

    <!-- User Profile Modal -->
    <div class="modal fade" id="userProfileModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="fas fa-user"></i> User Profile
            </h5>
            <button type="button" class="close" data-dismiss="modal">
              <span>&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="auth-messages"></div>
            
            <!-- Profile Information Tab -->
            <ul class="nav nav-tabs" id="profileTabs" role="tablist">
              <li class="nav-item">
                <a class="nav-link active" id="profile-tab" data-toggle="tab" href="#profile" role="tab">
                  <i class="fas fa-user"></i> Profile
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="security-tab" data-toggle="tab" href="#security" role="tab">
                  <i class="fas fa-lock"></i> Security
                </a>
              </li>
            </ul>

            <div class="tab-content mt-3" id="profileTabsContent">
              <!-- Profile Tab -->
              <div class="tab-pane fade show active" id="profile" role="tabpanel">
                <form onsubmit="event.preventDefault(); updateUserProfile();">
                  <div class="row">
                    <div class="col-12 col-md-6">
                      <div class="form-group">
                        <label for="profileFullName">
                          <i class="fas fa-user"></i> Full Name
                        </label>
                        <input 
                          type="text" 
                          class="form-control" 
                          id="profileFullName" 
                          required
                        >
                      </div>
                    </div>
                    <div class="col-12 col-md-6">
                      <div class="form-group">
                        <label for="profileBusinessName">
                          <i class="fas fa-building"></i> Business Name
                        </label>
                        <input 
                          type="text" 
                          class="form-control" 
                          id="profileBusinessName"
                        >
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-12 col-md-6">
                      <div class="form-group">
                        <label for="profileEmail">
                          <i class="fas fa-envelope"></i> Email Address
                        </label>
                        <input 
                          type="email" 
                          class="form-control" 
                          id="profileEmail" 
                          readonly
                          title="Email cannot be changed"
                        >
                      </div>
                    </div>
                    <div class="col-12 col-md-6">
                      <div class="form-group">
                        <label for="profilePhone">
                          <i class="fas fa-phone"></i> Phone Number
                        </label>
                        <input 
                          type="tel" 
                          class="form-control" 
                          id="profilePhone"
                          placeholder="(555) 123-4567"
                        >
                      </div>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="profileAddress">
                      <i class="fas fa-map-marker-alt"></i> Business Address
                    </label>
                    <textarea 
                      class="form-control" 
                      id="profileAddress" 
                      rows="2"
                      placeholder="Your business address"
                    ></textarea>
                  </div>
                  <div class="row">
                    <div class="col-12 col-md-6">
                      <div class="form-group">
                        <label for="profileTaxId">
                          <i class="fas fa-file-invoice"></i> Tax ID / EIN
                        </label>
                        <input 
                          type="text" 
                          class="form-control" 
                          id="profileTaxId"
                          placeholder="12-3456789"
                        >
                      </div>
                    </div>
                    <div class="col-12 col-md-6">
                      <div class="form-group">
                        <label for="profileCurrency">
                          <i class="fas fa-dollar-sign"></i> Currency
                        </label>
                        <select class="form-control" id="profileCurrency">
                          <option value="USD">USD - US Dollar</option>
                          <option value="EUR">EUR - Euro</option>
                          <option value="GBP">GBP - British Pound</option>
                          <option value="CAD">CAD - Canadian Dollar</option>
                          <option value="AUD">AUD - Australian Dollar</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="text-right">
                    <button type="submit" class="btn btn-primary">
                      <i class="fas fa-save"></i> Update Profile
                    </button>
                  </div>
                </form>
              </div>

              <!-- Security Tab -->
              <div class="tab-pane fade" id="security" role="tabpanel">
                <form onsubmit="event.preventDefault(); changeUserPassword();">
                  <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <strong>Password Requirements:</strong> Must be at least 6 characters with uppercase, lowercase, and number.
                  </div>
                  <div class="form-group">
                    <label for="currentPassword">
                      <i class="fas fa-lock"></i> Current Password
                    </label>
                    <input 
                      type="password" 
                      class="form-control" 
                      id="currentPassword" 
                      required
                      autocomplete="current-password"
                    >
                  </div>
                  <div class="row">
                    <div class="col-12 col-md-6">
                      <div class="form-group">
                        <label for="newPassword">
                          <i class="fas fa-key"></i> New Password
                        </label>
                        <input 
                          type="password" 
                          class="form-control" 
                          id="newPassword" 
                          required
                          autocomplete="new-password"
                        >
                      </div>
                    </div>
                    <div class="col-12 col-md-6">
                      <div class="form-group">
                        <label for="confirmNewPassword">
                          <i class="fas fa-check"></i> Confirm New Password
                        </label>
                        <input 
                          type="password" 
                          class="form-control" 
                          id="confirmNewPassword" 
                          required
                          autocomplete="new-password"
                        >
                      </div>
                    </div>
                  </div>
                  <div class="text-right">
                    <button type="submit" class="btn btn-warning">
                      <i class="fas fa-key"></i> Change Password
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">
              <i class="fas fa-times"></i> Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    
    <!-- Firebase Configuration -->
    <script src="firebase-config.js"></script>
    
    <!-- Firebase Auth System -->
    <script src="firebase-auth.js"></script>
    
    <!-- LocalStorage Auth System (fallback) -->
    <script src="auth.js"></script>
    
    <!-- Other Scripts -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
      // Mobile navigation functions
      function toggleMobileNav() {
        const sidebar = document.querySelector('.sidebar');
        const overlay = document.querySelector('.sidebar-overlay');
        
        sidebar.classList.toggle('show');
        overlay.classList.toggle('show');
        
        // Prevent body scroll when menu is open
        if (sidebar.classList.contains('show')) {
          document.body.style.overflow = 'hidden';
        } else {
          document.body.style.overflow = '';
        }
      }

      function closeMobileNav() {
        const sidebar = document.querySelector('.sidebar');
        const overlay = document.querySelector('.sidebar-overlay');
        
        sidebar.classList.remove('show');
        overlay.classList.remove('show');
        document.body.style.overflow = '';
      }

      // Close mobile nav when clicking outside or on escape
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closeMobileNav();
        }
      });

      // Prevent zoom on form inputs for iOS
      if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
        document.addEventListener('touchstart', function() {}, true);
      }
    </script>
    
    <!-- Global Authentication Functions -->
    <script>
      // Global function to show authentication messages
      function showAuthMessage(message, type) {
        const alertElement = document.createElement('div');
        alertElement.className = `alert alert-${type} alert-dismissible fade show auth-message`;
        alertElement.innerHTML = `
          ${message}
          <button type="button" class="close" data-dismiss="alert">
            <span>&times;</span>
          </button>
        `;

        // Find the appropriate container for the message
        const messageContainer = document.querySelector('.auth-messages') || 
                               document.querySelector('.modal-body') || 
                               document.querySelector('#loginContainer');
        
        if (messageContainer) {
          messageContainer.insertBefore(alertElement, messageContainer.firstChild);
          
          // Auto-remove after 5 seconds
          setTimeout(() => {
            if (alertElement.parentNode) {
              alertElement.parentNode.removeChild(alertElement);
            }
          }, 5000);
        }
      }

      // Initialize the application when DOM is loaded
      document.addEventListener('DOMContentLoaded', function() {
        // Initial UI setup - show login form by default
        showLoginForm();
        
        // Add login-page class to body initially
        document.body.classList.add('login-page');
        
        // Wait for authentication system to initialize
        setTimeout(function() {
          if (window.authSystem) {
            console.log('✅ Authentication system initialized');
            
            // Check if user is already logged in
            if (window.authSystem.currentUser) {
              console.log('✅ User already logged in, showing main app');
              window.authSystem.showMainApp();
            } else {
              console.log('ℹ️ No user logged in, showing login screen');
              window.authSystem.showLoginScreen();
            }
          } else {
            console.log('⚠️ No authentication system found, showing login screen');
            document.getElementById('loginContainer').style.display = 'block';
            document.getElementById('mainApp').style.display = 'none';
            document.body.classList.add('login-page');
          }
        }, 1000);
      });

             // Global form switching functions
       function showLoginForm() {
         const loginForm = document.getElementById('loginForm');
         const registerForm = document.getElementById('registerForm');
         const forgotForm = document.getElementById('forgotPasswordForm');
         
         if (loginForm) loginForm.style.display = 'block';
         if (registerForm) registerForm.style.display = 'none';
         if (forgotForm) forgotForm.style.display = 'none';
       }

       function showRegisterForm() {
         const loginForm = document.getElementById('loginForm');
         const registerForm = document.getElementById('registerForm');
         const forgotForm = document.getElementById('forgotPasswordForm');
         
         if (loginForm) loginForm.style.display = 'none';
         if (registerForm) registerForm.style.display = 'block';
         if (forgotForm) forgotForm.style.display = 'none';
       }

       function showForgotPasswordForm() {
         const loginForm = document.getElementById('loginForm');
         const registerForm = document.getElementById('registerForm');
         const forgotForm = document.getElementById('forgotPasswordForm');
         
         if (loginForm) loginForm.style.display = 'none';
         if (registerForm) registerForm.style.display = 'none';
         if (forgotForm) forgotForm.style.display = 'block';
       }

       // Universal authentication functions that work with both Firebase and localStorage
       function performLogin() {
         const username = document.getElementById('loginUsername').value;
         const password = document.getElementById('loginPassword').value;

         if (!username || !password) {
           showAuthMessage('Please enter both username/email and password', 'danger');
           return;
         }

         if (window.authSystem && window.authSystem.login) {
           window.authSystem.login({ username, password }).then(result => {
             if (result.success) {
               showAuthMessage(result.message, 'success');
             } else {
               showAuthMessage(result.message, 'danger');
             }
           }).catch(error => {
             console.error('Login error:', error);
             showAuthMessage('Login failed. Please try again.', 'danger');
           });
         } else {
           showAuthMessage('Authentication system not available', 'danger');
         }
       }

       function performRegister() {
         const userData = {
           username: document.getElementById('registerUsername').value,
           email: document.getElementById('registerEmail').value,
           password: document.getElementById('registerPassword').value,
           confirmPassword: document.getElementById('registerConfirmPassword').value,
           fullName: document.getElementById('registerFullName').value,
           businessName: document.getElementById('registerBusinessName').value
         };

         // Basic validation
         if (!userData.username || !userData.email || !userData.password || !userData.fullName) {
           showAuthMessage('Please fill in all required fields', 'danger');
           return;
         }

         if (userData.password !== userData.confirmPassword) {
           showAuthMessage('Passwords do not match', 'danger');
           return;
         }

         if (window.authSystem && window.authSystem.register) {
           window.authSystem.register(userData).then(result => {
             if (result.success) {
               showAuthMessage(result.message, 'success');
             } else {
               showAuthMessage(result.message, 'danger');
             }
           }).catch(error => {
             console.error('Registration error:', error);
             showAuthMessage('Registration failed. Please try again.', 'danger');
           });
         } else {
           showAuthMessage('Authentication system not available', 'danger');
         }
       }

       function createDemoUser() {
         if (window.authSystem && window.authSystem.createDemoUser) {
           window.authSystem.createDemoUser().then(result => {
             if (result.success) {
               showAuthMessage('Demo user created and logged in successfully!', 'success');
             } else {
               showAuthMessage(result.message, 'danger');
             }
           }).catch(error => {
             console.error('Demo user creation error:', error);
             showAuthMessage('Failed to create demo user. Please try again.', 'danger');
           });
         } else {
           showAuthMessage('Authentication system not available', 'danger');
         }
       }

       function performLogout() {
         if (window.authSystem && window.authSystem.logout) {
           window.authSystem.logout().then(() => {
             showAuthMessage('You have been logged out successfully', 'info');
           }).catch(error => {
             console.error('Logout error:', error);
             window.location.reload(); // Force reload if logout fails
           });
         } else {
           showAuthMessage('Authentication system not available', 'danger');
         }
       }
    </script>
    
<script src="app.js"></script>

  </body>
</html>
